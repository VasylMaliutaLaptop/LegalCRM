@page "/"
@using Microsoft.AspNetCore.Authorization
@inject HttpClient Http
@attribute [Authorize]

<h3>Регистрация пользователя</h3>

<div>
    <label>Имя пользователя:</label>
    <input @bind="userName" />
</div>
<div>
    <label>Email:</label>
    <input @bind="email" type="email" />
</div>
<div>
    <label>Пароль:</label>
    <input @bind="password" type="password" />
</div>
<button @onclick="Register">Зарегистрироваться</button>

@if (message != null)
{
    <p>@message</p>
}

@code {
    private string userName = "firstuser";
    private string email = "firstuser@example.com";
    private string password = "SecurePassword123!";
    private string message = string.Empty;

    private async Task Register()
    {
        try
        {
            var registerModel = new
            {
                userName = userName,
                email = email,
                password = password
            };

            var response = await Http.PostAsJsonAsync("https://localhost:7083/api/account/register", registerModel);

            if (response.IsSuccessStatusCode)
            {
                message = "Пользователь успешно зарегистрирован";
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                message = $"Ошибка регистрации: {error}";
            }
        }
        catch (Exception ex)
        {
            message = $"Произошла ошибка: {ex.Message}";
        }
    }
}